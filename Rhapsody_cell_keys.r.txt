#!/usr/bin/env Rscript

L1 <- "ACTGGCCTGCGA"
L2 <- "GGTAGCGGTGACA"
L1.short <- "GTGA"
L2.short <- "GACA"

CLS1 <- c("GTCGCTATA", "CTTGTACTA", "CTTCACATA", "ACACGCCGG",
          "CGGTCCAGG", "AATCGAATG", "CCTAGTATA", "ATTGGCTAA",
          "AAGACATGC", "AAGGCGATC", "GTGTCCTTA", "GGATTAGGA",
          "ATGGATCCA", "ACATAAGCG", "AACTGTATT", "ACCTTGCGG",
          "CAGGTGTAG", "AGGAGATTA", "GCGATTACA", "ACCGGATAG",
          "CCACTTGGA", "AGAGAAGTT", "TAAGTTCGA", "ACGGATATT",
          "TGGCTCAGA", "GAATCTGTA", "ACCAAGGAC", "AGTATCTGT",
          "CACACACTA", "ATTAAGTGC", "AAGTAACCC", "AAATCCTGT",
          "CACATTGCA", "GCACTGTCA", "ATACTTAGG", "GCAATCCGA",
          "ACGCAATCA", "GAGTATTAG", "GACGGATTA", "CAGCTGACA",
          "CAACATATT", "AACTTCTCC", "CTATGAAAT", "ATTATTACC",
          "TACCGAGCA", "TCTCTTCAA", "TAAGCGTTA", "GCCTTACAA",
          "AGCACACAG", "ACAGTTCCG", "AGTAAAGCC", "CAGTTTCAC",
          "CGTTACTAA", "TTGTTCCAA", "AGAAGCACT", "CAGCAAGAT",
          "CAAACCGCC", "CTAACTCGC", "AATATTGGG", "AGAACTTCC",
          "CAAAGGCAC", "AAGCTCAAC", "TCCAGTCGA", "AGCCATCAC",
          "AACGAGAAG", "CTACAGAAC", "AGAGCTATG", "GAGGATGGA",
          "TGTACCTTA", "ACACACAAA", "TCAGGAGGA", "GAGGTGCTA",
          "ACCCTGACC", "ACAAGGATC", "ATCCCGGAG", "TATGTGGCA",
          "GCTGCCAAT", "ATCAGAGCT", "TCGAAGTGA", "ATAGACGAG",
          "AGCCCAATC", "CAGAATCGT", "ATCTCCACA", "ACGAAAGGT",
          "TAGCTTGTA", "ACACGAGAT", "AACCGCCTC", "ATTTAGATG",
          "CAAGCAAGC", "CAAAGTGTG", "GGCAAGCAA", "GAGCCAATA",
          "ATGTAATGG", "CCTGAGCAA", "GAGTACATT", "TGCGATCTA")

CLS2 <- c("TACAGGATA", "CACCAGGTA", "TGTGAAGAA", "GATTCATCA",
          "CACCCAAAG", "CACAAAGGC", "GTGTGTCGA", "CTAGGTCCT",
          "ACAGTGGTA", "TCGTTAGCA", "AGCGACACC", "AAGCTACTT",
          "TGTTCTCCA", "ACGCGAAGC", "CAGAAATCG", "ACCAAAATG",
          "AGTGTTGTC", "TAGGGATAC", "AGGGCTGGT", "TCATCCTAA",
          "AATCCTGAA", "ATCCTAGGA", "ACGACCACC", "TTCCATTGA",
          "TAGTCTTGA", "ACTGTTAGA", "ATTCATCGT", "ACTTCGAGC",
          "TTGCGTACA", "CAGTGCCCG", "GACACTTAA", "AGGAGGCGC",
          "GCCTGTTCA", "GTACATCTA", "AATCAGTTT", "ACGATGAAT",
          "TGACAGACA", "ATTAGGCAT", "GGAGTCTAA", "TAGAACACA",
          "AAATAAATA", "CCGACAAGA", "CACCTACCC", "AAGAGTAGA",
          "TCATTGAGA", "GACCTTAGA", "CAAGACCTA", "GGAATGATA",
          "AAACGTACC", "ACTATCCTC", "CCGTATCTA", "ACACATGTC",
          "TTGGTATGA", "GTGCAGTAA", "AGGATTCAA", "AGAATGGAG",
          "CTCTCTCAA", "GCTAACTCA", "ATCAACCGA", "ATGAGTTAC",
          "ACTTGATGA", "ACTTTAACT", "TTGGAGGTA", "GCCAATGTA",
          "ATCCAACCG", "GATGAACTG", "CCATGCACA", "TAGTGACTA",
          "AAACTGCGC", "ATTACCAAG", "CACTCGAGA", "AACTCATTG",
          "CTTGCTTCA", "ACCTGAGTC", "AGGTTCGCT", "AAGGACTAT",
          "CGTTCGGTA", "AGATAGTTC", "CAATTGATC", "GCATGGCTA",
          "ACCAGGTGT", "AGCTGCCGT", "TATAGCCCT", "AGAGGACCA",
          "ACAATATGG", "CAGCACTTC", "CACTTATGT", "AGTGAAAGG",
          "AACCCTCGG", "AGGCAGCTA", "AACCAAAGT", "GAGTGCGAA",
          "CGCTAAGCA", "AATTATAAC", "TACTAGTCA", "CAACAACGG")

CLS3 <- c("AAGCCTTCT", "ATCATTCTG", "CACAAGTAT", "ACACCTTAG",
          "GAACGACAA", "AGTCTGTAC", "AAATTACAG", "GGCTACAGA",
          "AATGTATCG", "CAAGTAGAA", "GATCTCTTA", "AACAACGCG",
          "GGTGAGTTA", "CAGGGAGGG", "TCCGTCTTA", "TGCATAGTA",
          "ACTTACGAT", "TGTATGCGA", "GCTCCTTGA", "GGCACAACA",
          "CTCAAGACA", "ACGCTGTTG", "ATATTGTAA", "AAGTTTACG",
          "CAGCCTGGC", "CTATTAGCC", "CAAACGTGG", "AAAGTCATT",
          "GTCTTGGCA", "GATCAGCGA", "ACATTCGGC", "AGTAATTAG",
          "TGAAGCCAA", "TCTACGACA", "CATAACGTT", "ATGGGACTC",
          "GATAGAGGA", "CTACATGCG", "CAACGATCT", "GTTAGCCTA",
          "AGTTGCATC", "AAGGGAACT", "ACTACATAT", "CTAAGCTTC",
          "ACGAACCAG", "TACTTCGGA", "AACATCCAT", "AGCCTGGTT",
          "CAAGTTTCC", "CAGGCATTT", "ACGTGGGAG", "TCTCACGGA",
          "GCAACATTA", "ATGGTCCGT", "CTATCATGA", "CAATACAAG",
          "AAAGAGGCC", "GTAGAAGCA", "GCTATGGAA", "ACTCCAGGG",
          "ACAAGTGCA", "GATGGTCCA", "TCCTCAATA", "AATAAACAA",
          "CTGTACGGA", "CTAGATAGA", "AGCTATGTG", "AAATGGAGG",
          "AGCCGCAAG", "ACAGTAAAC", "AACGTGTGA", "ACTGAATTC",
          "AAGGGTCAG", "TGTCTATCA", "TCAGATTCA", "CACGATCCG",
          "AACAGAAAC", "CATGAATGA", "CGTACTACG", "TTCAGCTCA",
          "AAGGCCGCA", "GGTTGGACA", "CGTCTAGGT", "AATTCGGCG",
          "CAACCTCCA", "CAATAGGGT", "ACAGGCTCC", "ACAACTAGT",
          "AGTTGTTCT", "AATTACCGG", "ACAAACTTT", "TCTCGGTTA",
          "ACTAGACCG", "ACTCATACG", "ATCGAGTCT", "CATAGGTCA")

rhapIndexToSeq <- function(index){
    index <- index - 1;
    code.1 <- floor(index / (96 * 96));
    index <- index - code.1 * (96 * 96);
    code.2 <- floor(index / 96);
    index <- index - code.2 * 96;
    code.3 <- index;
    paste0(CLS1[code.1+1], CLS2[code.2+1], CLS3[code.3+1]);
}

seqToRhapIndex <- function(seq){
    seq.1 <- substring(seq, 1, 9);
    seq.2 <- substring(seq, 10, 18);
    seq.3 <- substring(seq, 19, 27);
    #print(seq.1);
    #print(seq.2);
    #print(seq.3);
    code.1 <- match(seq.1, CLS1) - 1;
    code.2 <- match(seq.2, CLS2) - 1;
    code.3 <- match(seq.3, CLS3) - 1;
    #print(code.1);
    #print(code.2);
    #print(code.3);
    code.1 * 96 * 96 + code.2 * 96 + code.3 + 1;
}

cat("Checking inverse lookups:",
    seqToRhapIndex(rhapIndexToSeq(746833)) == 746833,
    rhapIndexToSeq(seqToRhapIndex("CAGAATCGTGATTCATCACAAGTTTCC")) ==
    "CAGAATCGTGATTCATCACAAGTTTCC", "\n");
